<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CEFRI</title>
</head>
<body>
    <script>
        const CONFIG = {
            repoOwner: "cefri",
            repoName: "cefri.github.io",
            fallbackUrl: "http://linktr.ee/cefri",
            distanceTolerance: 3
        };

        // Algorithme de Levenshtein
        function calculerDistance(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        async function initRedirection() {
            // 1. Nettoyage de l'URL entrante
            const path = window.location.pathname.replace(/\/$/, "");
            const segment = path.split("/").pop() || "";
            
            // On dÃ©code et on retire TOUTE extension (ex: .ht, .htm, .html, .txt)
            const urlSaisieNettoyee = decodeURIComponent(segment).replace(/\.[a-z0-9]+$/i, "");
            
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.repoOwner}/${CONFIG.repoName}/contents/`);
                if (!response.ok) throw new Error("Erreur API GitHub");

                const fichiers = await response.json();
                const pagesExistantes = fichiers
                    .filter(f => f.type === "file" && f.name.toLowerCase().endsWith(".html"))
                    .map(f => f.name);

                let meilleureCorrespondance = null;
                let distanceMinimale = CONFIG.distanceTolerance;

                // 2. Comparaison des noms de fichiers sans leurs extensions
                pagesExistantes.forEach(page => {
                    const nomPageNettoye = page.replace(/\.[a-z0-9]+$/i, "");
                    
                    const distance = calculerDistance(
                        urlSaisieNettoyee.toLowerCase(), 
                        nomPageNettoye.toLowerCase()
                    );
                    
                    if (distance < distanceMinimale) {
                        distanceMinimale = distance;
                        meilleureCorrespondance = page;
                    }
                });

                // 3. Action
                if (meilleureCorrespondance) {
                    window.location.replace("/" + meilleureCorrespondance);
                } else {
                    window.location.replace(CONFIG.fallbackUrl);
                }
            } catch (error) {
                window.location.replace(CONFIG.fallbackUrl);
            }
        }

        initRedirection();
    </script>
</body>
</html>
